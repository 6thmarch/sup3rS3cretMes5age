<!DOCTYPE html>
<html>

<head>



    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body>
    <!--Import jQuery before materialize.js-->
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.6.1/clipboard.min.js"></script>
    <div class="container">

        <div class="input-field">


            <textarea id="textarea1" name="msg" readonly=true class="materialize-textarea" placeholder="Message should apper here"></textarea>

        </div>
        <div class="button">
            <button class="btn" type="submit" data-clipboard-target="#textarea1" onclick="windows.alert('Copied!');" name="action">Copy to clipboard
              
            </button>
        </div>
    </div>


    <script type="text/javascript">
        $(document).ready(function () {
            new Clipboard('.btn');

            let params = (new URL(window.location)).searchParams;
            console.log(window.location.origin + "/secret?token=" + params.get('token'))
            $.ajax({
                type: "GET",
                url: window.location.origin + "/secret?token=" + params.get('token'),
                success: function (data) {
                    console.log('Submission was successful.');
                    console.log(data);
                    showMsg(data.msg)
                },
                error: function (data) {
                    console.log('An error occurred.');
                    console.log(data);
                    showMsg("Message was already deleted :(")
                },
            });
        });

        function showMsg(msg) {
            $('#pbar').hide()
            $('#textarea1').text(msg)
        }


        clipboard.on('error', function (e) {
            console.error('Action:', e.action);
            console.error('Trigger:', e.trigger);
        });

        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }
    </script>
</body>

</html>